# 实现计划

## 目录结构

```
CreatorFlow/
├── packages/
│   └── shared/
│       └── src/
│           └── social-publisher/              # 内置模块
│               ├── index.ts                   # 模块入口，导出所有公共 API
│               ├── types.ts                   # 类型定义
│               │
│               ├── manager.ts                 # SocialPublisherManager 主管理器
│               ├── account-manager.ts         # 账号管理器
│               ├── content-manager.ts         # 内容管理器
│               ├── session-manager.ts         # 登录态管理器
│               ├── browser-manager.ts         # Playwright 浏览器管理
│               ├── scheduler.ts               # 定时任务调度器
│               │
│               ├── storage/
│               │   ├── index.ts               # 存储层入口
│               │   ├── account-storage.ts     # 账号数据存储（加密 JSON）
│               │   └── content-storage.ts     # 内容数据存储（SQLite）
│               │
│               ├── mcp/
│               │   ├── index.ts               # MCP Server 入口
│               │   ├── server.ts              # MCP Server 实现
│               │   └── tools.ts               # MCP 工具定义
│               │
│               └── adapters/                  # 平台适配器
│                   ├── index.ts               # 适配器注册表
│                   ├── base.ts                # 基础适配器抽象类
│                   ├── xiaohongshu.ts         # 小红书适配器
│                   ├── douyin.ts              # 抖音适配器
│                   ├── wechat-mp.ts           # 微信公众号适配器
│                   ├── bilibili.ts            # B站适配器
│                   ├── kuaishou.ts            # 快手适配器
│                   ├── weibo.ts               # 微博适配器
│                   └── zhihu.ts               # 知乎适配器
│
├── apps/
│   └── electron/
│       └── src/
│           ├── main/
│           │   └── social-publisher/          # 主进程服务
│           │       ├── index.ts               # 服务入口
│           │       ├── service.ts             # 主进程服务封装
│           │       └── ipc-handlers.ts        # IPC 处理器
│           │
│           ├── preload/
│           │   └── social-publisher.ts        # Preload API
│           │
│           └── renderer/
│               └── components/
│                   └── social-publisher/      # UI 组件
│                       ├── index.tsx          # 模块入口
│                       ├── SocialPublisherLayout.tsx
│                       ├── tabs/
│                       │   ├── AccountsTab.tsx
│                       │   ├── PublishTab.tsx
│                       │   ├── PostsTab.tsx
│                       │   ├── StatsTab.tsx
│                       │   └── ScheduleTab.tsx
│                       ├── components/
│                       │   ├── AccountCard.tsx
│                       │   ├── AddAccountModal.tsx
│                       │   ├── ContentEditor.tsx
│                       │   ├── MediaUploader.tsx
│                       │   ├── TagInput.tsx
│                       │   ├── PlatformSelector.tsx
│                       │   ├── PostCard.tsx
│                       │   ├── CommentsModal.tsx
│                       │   ├── StatsChart.tsx
│                       │   └── ScheduleList.tsx
│                       ├── hooks/
│                       │   ├── useAccounts.ts
│                       │   ├── usePublish.ts
│                       │   ├── usePosts.ts
│                       │   └── useStats.ts
│                       └── store/
│                           └── socialPublisherStore.ts
```

## 技术依赖

```json
{
  "dependencies": {
    "playwright": "^1.40.0",
    "better-sqlite3": "^9.0.0"
  },
  "devDependencies": {
    "@types/better-sqlite3": "^7.6.0"
  }
}
```

## 分阶段实现计划

### 阶段 P0: 核心框架 + 小红书适配器

**目标**: 搭建完整的框架，实现小红书平台的基本发布功能

**任务清单**:

1. **类型定义** (`types.ts`)
   - [ ] 定义 SocialPlatform、AccountStatus 等枚举
   - [ ] 定义 SocialAccount、PublishContent、PublishRecord 等接口
   - [ ] 定义 PlatformAdapter 接口

2. **存储层** (`storage/`)
   - [ ] 实现 AccountStorage（加密 JSON 存储）
   - [ ] 实现 ContentStorage（SQLite 存储）
   - [ ] 编写数据库迁移脚本

3. **登录态管理** (`session-manager.ts`)
   - [ ] 实现 storageState 加密存储
   - [ ] 实现 storageState 加载和解密
   - [ ] 集成现有凭证加密机制

4. **浏览器管理** (`browser-manager.ts`)
   - [ ] 实现 Playwright 浏览器启动和管理
   - [ ] 实现反检测脚本注入
   - [ ] 实现人类行为模拟工具类

5. **基础适配器** (`adapters/base.ts`)
   - [ ] 实现 BasePlatformAdapter 抽象类
   - [ ] 实现通用的登录等待逻辑
   - [ ] 实现通用的媒体上传逻辑

6. **小红书适配器** (`adapters/xiaohongshu.ts`)
   - [ ] 实现登录流程（扫码登录）
   - [ ] 实现图文笔记发布
   - [ ] 实现视频笔记发布
   - [ ] 实现内容列表获取
   - [ ] 实现数据统计同步

7. **主管理器** (`manager.ts`)
   - [ ] 实现 SocialPublisherManager
   - [ ] 整合账号、内容、会话管理器

8. **Electron 集成**
   - [ ] 实现主进程服务 (`main/social-publisher/service.ts`)
   - [ ] 实现 IPC 处理器
   - [ ] 实现 Preload API

9. **基础 UI**
   - [ ] 实现账号管理页面
   - [ ] 实现添加账号弹窗
   - [ ] 实现基础发布页面

**验收标准**:
- 可以登录小红书账号并保存登录态
- 可以发布图文/视频笔记到小红书
- 可以查看已发布内容列表
- 可以同步数据统计

---

### 阶段 P1: 抖音 + 微信公众号适配器

**目标**: 扩展支持抖音和微信公众号平台

**任务清单**:

1. **抖音适配器** (`adapters/douyin.ts`)
   - [ ] 实现扫码登录
   - [ ] 实现视频发布（含封面设置）
   - [ ] 实现内容列表获取
   - [ ] 实现数据统计同步

2. **微信公众号适配器** (`adapters/wechat-mp.ts`)
   - [ ] 实现扫码登录
   - [ ] 实现图文消息发布
   - [ ] 实现视频消息发布
   - [ ] 研究官方 API 集成可行性
   - [ ] 实现内容列表获取

3. **UI 完善**
   - [ ] 完善发布页面（支持不同平台的特殊字段）
   - [ ] 实现已发布内容页面
   - [ ] 实现内容详情弹窗

**验收标准**:
- 可以登录抖音和微信公众号
- 可以发布内容到这两个平台
- UI 能正确处理不同平台的差异

---

### 阶段 P2: B站 + 快手适配器

**目标**: 扩展支持 B站和快手平台

**任务清单**:

1. **B站适配器** (`adapters/bilibili.ts`)
   - [ ] 实现扫码/密码登录
   - [ ] 实现视频投稿（含分区选择）
   - [ ] 实现专栏文章发布
   - [ ] 实现分P上传支持
   - [ ] 实现内容列表获取

2. **快手适配器** (`adapters/kuaishou.ts`)
   - [ ] 实现扫码登录
   - [ ] 实现视频发布
   - [ ] 实现内容列表获取

3. **视频处理优化**
   - [ ] 实现视频格式检测
   - [ ] 实现视频转码提示
   - [ ] 实现封面自动截取

**验收标准**:
- 可以登录 B站和快手
- 可以发布视频到这两个平台
- B站支持分P上传和专栏文章

---

### 阶段 P3: 微博 + 知乎适配器

**目标**: 扩展支持微博和知乎平台

**任务清单**:

1. **微博适配器** (`adapters/weibo.ts`)
   - [ ] 实现扫码/密码登录
   - [ ] 实现图文微博发布
   - [ ] 实现视频微博发布
   - [ ] 实现内容列表获取
   - [ ] 研究官方 API 集成

2. **知乎适配器** (`adapters/zhihu.ts`)
   - [ ] 实现手机号登录
   - [ ] 实现文章发布
   - [ ] 实现想法发布
   - [ ] 实现视频发布
   - [ ] 实现内容列表获取

**验收标准**:
- 可以登录微博和知乎
- 可以发布内容到这两个平台
- 知乎支持文章和想法两种形式

---

### 阶段 P4: 数据统计 + 评论管理

**目标**: 完善数据统计和评论管理功能

**任务清单**:

1. **数据统计功能**
   - [ ] 实现各平台数据统计同步
   - [ ] 实现账号整体统计
   - [ ] 实现数据趋势图表
   - [ ] 实现热门内容排行

2. **评论管理功能**
   - [ ] 实现各平台评论获取
   - [ ] 实现评论回复
   - [ ] 实现评论删除
   - [ ] 实现评论管理 UI

3. **UI 完善**
   - [ ] 实现数据统计页面
   - [ ] 实现评论管理弹窗
   - [ ] 实现数据导出功能

**验收标准**:
- 可以查看各平台的数据统计
- 可以查看和管理评论
- 数据图表正确显示趋势

---

### 阶段 P5: 定时发布 + 批量发布优化

**目标**: 完善定时发布和批量发布功能

**任务清单**:

1. **定时发布功能**
   - [ ] 实现定时任务调度器
   - [ ] 实现任务持久化和恢复
   - [ ] 实现任务状态管理
   - [ ] 实现定时任务 UI

2. **批量发布优化**
   - [ ] 实现一键多平台发布
   - [ ] 实现发布进度显示
   - [ ] 实现失败重试机制
   - [ ] 实现发布结果汇总

3. **MCP Server**
   - [ ] 实现完整的 MCP Server
   - [ ] 实现所有 MCP 工具
   - [ ] 编写 Agent 调用示例

4. **稳定性优化**
   - [ ] 实现登录态定期检查
   - [ ] 实现错误恢复机制
   - [ ] 实现日志记录
   - [ ] 编写单元测试

**验收标准**:
- 定时发布功能正常工作
- 批量发布能正确处理多平台
- MCP Server 可被 Agent 正常调用
- 系统稳定性达到生产标准

---

## 风险和挑战

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 平台反爬虫升级 | 登录/发布失败 | 持续更新反检测策略，保持适配器可维护性 |
| 平台 UI 变更 | 选择器失效 | 使用稳定的选择器策略，建立 UI 变更监控 |
| 登录态频繁过期 | 用户体验差 | 实现智能检测和提醒，优化登录流程 |
| 视频上传慢 | 发布耗时长 | 实现进度显示，支持后台上传 |
| 账号被封禁 | 功能不可用 | 提供风险提示，建议合理使用频率 |

## 测试策略

1. **单元测试**
   - 存储层测试
   - 加密/解密测试
   - 数据模型测试

2. **集成测试**
   - 登录流程测试（需要测试账号）
   - 发布流程测试
   - 数据同步测试

3. **E2E 测试**
   - 完整的发布流程
   - UI 交互测试

4. **手动测试**
   - 各平台真实账号测试
   - 边界情况测试
   - 异常恢复测试

## 文档计划

- [ ] API 文档（MCP 工具使用说明）
- [ ] 用户指南（如何添加账号、发布内容）
- [ ] 开发者文档（如何添加新平台适配器）
- [ ] 故障排除指南
