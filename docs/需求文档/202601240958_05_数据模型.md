# Craft Creator 产品定义文档 - 第五部分：核心数据模型

**文档信息**
- 模型：Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)
- 创建时间：2026-01-24 09:58:00
- 作者：@Ysf

---

## 数据模型概览

Craft Creator 的数据模型设计遵循以下原则：
1. **关联性**：所有数据互相关联，形成知识图谱
2. **可追溯**：记录完整的创作历史和版本
3. **可学习**：数据结构支持 AI 学习和分析
4. **可扩展**：预留扩展字段，支持未来功能

---

## 核心实体关系图

```
┌─────────────┐
│ UserProfile │ (1)
│  用户画像    │
└──────┬──────┘
       │ 1:N
       ↓
┌─────────────┐
│   Project   │ (N)
│    项目     │
└──────┬──────┘
       │ 1:1
       ↓
┌─────────────┐         ┌─────────────┐
│   Script    │ (1)     │    Asset    │ (N)
│    脚本     │←────────┤    素材     │
└──────┬──────┘   N:N   └─────────────┘
       │ 1:N
       ↓
┌─────────────┐
│   Content   │ (N)
│  生成内容    │
└─────────────┘
```

---

## 1. UserProfile（用户画像）

### 数据结构

```typescript
interface UserProfile {
  // 基础信息
  userId: string
  email: string
  username: string
  avatar?: string
  createdAt: Date
  updatedAt: Date

  // 订阅信息
  subscription: {
    plan: 'free' | 'pro' | 'team'
    status: 'active' | 'expired' | 'cancelled'
    startDate: Date
    endDate?: Date
    aiQuotaUsed: number      // 本月已用 AI 对话次数
    aiQuotaLimit: number     // 本月限额
    storageUsed: number      // 已用存储（字节）
    storageLimit: number     // 存储限额（字节）
  }

  // 创作偏好
  preferences: {
    // 内容风格
    contentStyle: {
      pacing: 'fast' | 'medium' | 'slow'        // 节奏
      tone: 'humorous' | 'serious' | 'casual'   // 语气
      openingStyle: 'suspense' | 'direct' | 'story'  // 开场风格
      visualStyle: string[]                      // 视觉风格标签
    }

    // 常用元素
    favoriteAssets: string[]        // 常用素材 ID
    favoriteTemplates: string[]     // 常用模板 ID
    colorPalette: string[]          // 偏好配色
    musicGenres: string[]           // 偏好音乐类型

    // 平台偏好
    primaryPlatforms: ('douyin' | 'bilibili' | 'xiaohongshu')[]

    // 创作习惯
    averageProductionTime: number   // 平均创作时长（分钟）
    preferredWorkingHours: string   // 偏好工作时段 "09:00-12:00"
    autoSaveInterval: number        // 自动保存间隔（秒）
  }

  // 学习数据
  learningModel: {
    // 成功模式
    successPatterns: {
      scriptStructures: any[]       // 成功的脚本结构
      assetCombinations: any[]      // 成功的素材组合
      openingFormulas: string[]     // 成功的开场公式
    }

    // 素材使用模式
    assetUsagePatterns: {
      frequentPairs: [string, string][]  // 常一起使用的素材对
      categoryPreferences: Record<string, number>  // 类别偏好权重
      timeOfDayPreferences: Record<string, string[]>  // 时段偏好
    }

    // 脚本结构模式
    scriptStructurePatterns: {
      averageSectionCount: number   // 平均段落数
      averageSectionDuration: number  // 平均段落时长
      commonTransitions: string[]   // 常用转场
    }

    // 学习权重
    weights: {
      styleWeight: number           // 风格权重
      assetWeight: number           // 素材权重
      structureWeight: number       // 结构权重
    }

    // 最后更新时间
    lastUpdated: Date
  }

  // 统计数据
  stats: {
    totalProjects: number
    totalAssets: number
    totalVideosGenerated: number
    totalArticlesGenerated: number
    averageProjectDuration: number  // 平均项目耗时（分钟）
    averagePerformance: {
      views: number
      likes: number
      comments: number
    }
  }

  // 设置
  settings: {
    language: 'zh-CN' | 'en-US'
    theme: 'light' | 'dark' | 'auto'
    notifications: {
      email: boolean
      desktop: boolean
      aiSuggestions: boolean
    }
    privacy: {
      allowDataCollection: boolean
      allowAnonymousAnalytics: boolean
    }
  }
}
```

---

## 2. Project（项目）

### 数据结构

```typescript
interface Project {
  // 基础信息
  id: string
  userId: string
  name: string
  description?: string
  type: 'video' | 'article' | 'carousel'  // 内容类型
  status: 'ideation' | 'scripting' | 'production' | 'review' | 'published' | 'archived'

  // 目标平台
  platforms: {
    platform: 'douyin' | 'bilibili' | 'xiaohongshu' | 'wechat'
    format: {
      aspectRatio: '16:9' | '9:16' | '1:1' | '4:3'
      duration?: number      // 目标时长（秒）
      resolution?: string    // 分辨率 "1920x1080"
    }
    published: boolean
    publishedAt?: Date
    publishUrl?: string
    performance?: {
      views: number
      likes: number
      comments: number
      shares: number
    }
  }[]

  // 关联数据
  scriptId?: string          // 关联的脚本
  assetIds: string[]         // 关联的素材
  contentIds: string[]       // 生成的内容

  // 创作元数据
  metadata: {
    topic: string            // 主题
    keywords: string[]       // 关键词
    targetAudience: string   // 目标受众
    estimatedDuration: number  // 预计时长（秒）
    actualDuration?: number    // 实际时长（秒）
  }

  // 时间戳
  createdAt: Date
  updatedAt: Date
  publishedAt?: Date
  archivedAt?: Date

  // 标签和分类
  tags: string[]
  category: string

  // AI 生成记录
  aiGeneration: {
    intentPrompt: string     // 用户原始意图
    analysisResult: any      // AI 分析结果
    generatedAt: Date
  }

  // 协作信息（团队版）
  collaboration?: {
    teamId: string
    members: {
      userId: string
      role: 'owner' | 'editor' | 'viewer'
      joinedAt: Date
    }[]
    sharedAt: Date
  }
}
```

---

## 3. Script（脚本）

### 数据结构

```typescript
interface Script {
  // 基础信息
  id: string
  projectId: string
  title: string
  description?: string

  // 脚本内容（结构化）
  sections: ScriptSection[]

  // 全局配置
  globalSettings: {
    defaultVoice: string     // 默认配音声音
    defaultMusicVolume: number  // 默认音乐音量
    defaultTransition: string   // 默认转场
    subtitleStyle: {
      font: string
      size: number
      color: string
      position: 'top' | 'bottom' | 'center'
    }
  }

  // 版本管理
  version: number
  history: ScriptVersion[]

  // 统计信息
  stats: {
    totalDuration: number    // 总时长（秒）
    totalSections: number    // 总段落数
    totalWords: number       // 总字数
    estimatedReadingTime: number  // 预计阅读时间（秒）
  }

  // AI 生成元数据
  aiMetadata: {
    generatedBy: 'ai' | 'user' | 'collaborative'
    aiPrompt?: string        // 生成时的用户意图
    referenceVideos?: string[]  // 参考视频
    analysisData?: any       // 分析数据
  }

  // 时间戳
  createdAt: Date
  updatedAt: Date
  lastEditedBy: string     // 最后编辑者
}

// 脚本段落
interface ScriptSection {
  id: string
  order: number            // 顺序
  type: 'opening' | 'body' | 'transition' | 'closing'
  title?: string           // 段落标题

  // 内容
  content: string          // 文本内容（Markdown）
  duration: number         // 预计时长（秒）

  // 配音
  voiceOver: {
    text: string           // 配音文本
    voice: string          // 声音类型
    speed: number          // 语速 (0.5-2.0)
    pitch: number          // 音调 (-10 to 10)
    volume: number         // 音量 (0-100)
    generatedAudioUrl?: string  // 生成的音频 URL
  }

  // 字幕
  subtitles: {
    text: string
    startTime: number      // 开始时间（秒）
    endTime: number        // 结束时间（秒）
    style?: any            // 自定义样式
  }[]

  // 素材需求
  assetRequirements: {
    id: string
    type: 'video' | 'image' | 'audio'
    description: string    // "需要一个日落的镜头"
    duration?: number      // 需要的时长（秒）
    suggestedAssetIds: string[]  // AI 推荐的素材
    selectedAssetId?: string     // 用户选择的素材
    placement: 'background' | 'overlay' | 'fullscreen'
  }[]

  // 视觉效果
  visualEffects: {
    transition?: string    // 转场效果
    filter?: string        // 滤镜
    animation?: string     // 动画效果
  }

  // 导演备注
  notes?: string
}

// 脚本版本
interface ScriptVersion {
  version: number
  content: ScriptSection[]
  changedBy: string
  changedAt: Date
  changeDescription: string
  diff?: any               // 与上一版本的差异
}
```

---

## 4. Asset（素材）

### 数据结构

```typescript
interface Asset {
  // 基础信息
  id: string
  userId: string
  name: string
  description?: string
  type: 'video' | 'image' | 'audio' | 'text'

  // 文件信息
  source: 'local' | 'web' | 'ai-generated'
  localPath?: string       // 本地路径
  url?: string             // 云端 URL
  thumbnailUrl?: string    // 缩略图 URL
  fileSize: number         // 文件大小（字节）
  mimeType: string         // MIME 类型
  hash: string             // 文件哈希（用于去重）

  // 媒体属性
  mediaProperties: {
    // 图片/视频
    width?: number
    height?: number
    aspectRatio?: string   // "16:9"

    // 视频/音频
    duration?: number      // 时长（秒）
    bitrate?: number       // 比特率
    codec?: string         // 编码格式

    // 视频特有
    fps?: number           // 帧率
    keyframes?: number[]   // 关键帧时间点

    // 音频特有
    sampleRate?: number    // 采样率
    channels?: number      // 声道数
  }

  // AI 分析结果
  aiAnalysis: {
    // 通用
    tags: string[]         // 自动识别的标签
    description: string    // AI 生成的描述
    confidence: number     // 置信度 (0-1)

    // 图片/视频
    objects?: string[]     // 识别的物体
    scenes?: string[]      // 场景类型
    dominantColors?: string[]  // 主色调
    mood?: string          // 情绪（欢快、严肃等）
    faces?: {              // 人脸信息
      count: number
      emotions: string[]
    }

    // 视频特有
    keyMoments?: {         // 关键时刻
      timestamp: number
      description: string
      thumbnail: string
    }[]

    // 音频特有
    tempo?: number         // 节奏（BPM）
    genre?: string         // 音乐类型
    instruments?: string[] // 乐器

    // 向量化表示（用于语义搜索）
    embedding: number[]    // 768 维向量
  }

  // 使用记录
  usage: {
    usedInProjects: string[]  // 被哪些项目使用
    usageCount: number
    lastUsedAt?: Date
    averageRating?: number    // 用户评分
  }

  // 分类和组织
  collections: string[]    // 所属素材集
  tags: string[]           // 用户自定义标签
  category: string         // 分类

  // 来源信息
  sourceInfo?: {
    platform?: string      // 来源平台（Unsplash、Pexels）
    author?: string        // 作者
    license?: string       // 许可证
    sourceUrl?: string     // 原始 URL
  }

  // 时间戳
  createdAt: Date
  updatedAt: Date
  importedAt: Date

  // 状态
  status: 'processing' | 'ready' | 'error'
  processingProgress?: number  // 处理进度 (0-100)
  errorMessage?: string
}
```

---

## 5. Content（生成的内容）

### 数据结构

```typescript
interface Content {
  // 基础信息
  id: string
  projectId: string
  scriptId: string
  userId: string
  type: 'video' | 'article' | 'carousel'
  name: string

  // 生成配置
  generationConfig: {
    platform: string       // 目标平台
    format: {
      aspectRatio: string
      resolution: string
      duration?: number
      quality: 'low' | 'medium' | 'high' | 'ultra'
    }
    template?: string      // 使用的模板
    style?: string         // 风格
  }

  // 生成结果
  output: {
    localPath?: string     // 本地文件路径
    cloudUrl?: string      // 云端 URL
    thumbnailUrl?: string  // 缩略图
    fileSize: number       // 文件大小（字节）
    duration?: number      // 实际时长（秒）
    resolution?: string    // 实际分辨率
  }

  // 生成过程记录
  generationLog: {
    step: string           // 步骤名称
    status: 'pending' | 'processing' | 'success' | 'failed'
    startTime: Date
    endTime?: Date
    duration?: number      // 耗时（秒）
    details?: any          // 详细信息
    errorMessage?: string
  }[]

  // 使用的素材
  usedAssets: {
    assetId: string
    usage: string          // 使用方式
    startTime?: number     // 开始时间（秒）
    endTime?: number       // 结束时间（秒）
  }[]

  // 质量评估
  qualityAssessment?: {
    overallScore: number   // 总体评分 (0-100)
    issues: {
      type: string         // 问题类型
      severity: 'low' | 'medium' | 'high'
      description: string
      timestamp?: number   // 问题位置（秒）
    }[]
    suggestions: string[]  // 改进建议
  }

  // 发布记录
  publications: {
    platform: string
    publishedAt: Date
    publishUrl: string
    status: 'published' | 'failed' | 'removed'
    performance?: {
      views: number
      likes: number
      comments: number
      shares: number
      lastUpdated: Date
    }
  }[]

  // 版本信息
  version: number
  parentContentId?: string  // 父版本 ID（如果是修改版）

  // 时间戳
  createdAt: Date
  updatedAt: Date

  // 状态
  status: 'generating' | 'ready' | 'published' | 'archived' | 'failed'
  progress?: number        // 生成进度 (0-100)
}
```

---

## 数据关系详解

### Project ↔ Script (1:1)
```typescript
// 一个项目对应一个主脚本
project.scriptId → script.id
script.projectId → project.id
```

### Project ↔ Asset (N:N)
```typescript
// 一个项目可以使用多个素材
// 一个素材可以被多个项目使用
project.assetIds → [asset.id, ...]
asset.usage.usedInProjects → [project.id, ...]
```

### Script ↔ Asset (N:N)
```typescript
// 脚本段落引用素材
script.sections[].assetRequirements[].selectedAssetId → asset.id
```

### Project ↔ Content (1:N)
```typescript
// 一个项目可以生成多个内容（不同平台）
project.contentIds → [content.id, ...]
content.projectId → project.id
```

### UserProfile ↔ Project (1:N)
```typescript
// 一个用户可以创建多个项目
userProfile.userId → project.userId
```

---

## 索引设计

### 数据库索引

```sql
-- Project 表
CREATE INDEX idx_project_user ON projects(user_id);
CREATE INDEX idx_project_status ON projects(status);
CREATE INDEX idx_project_created ON projects(created_at DESC);

-- Script 表
CREATE INDEX idx_script_project ON scripts(project_id);
CREATE INDEX idx_script_updated ON scripts(updated_at DESC);

-- Asset 表
CREATE INDEX idx_asset_user ON assets(user_id);
CREATE INDEX idx_asset_type ON assets(type);
CREATE INDEX idx_asset_hash ON assets(hash);
CREATE INDEX idx_asset_tags ON assets USING GIN(tags);

-- Content 表
CREATE INDEX idx_content_project ON contents(project_id);
CREATE INDEX idx_content_status ON contents(status);
```

### 向量索引

```typescript
// 素材向量索引（用于语义搜索）
interface VectorIndex {
  assetId: string
  embedding: number[]  // 768 维向量
  metadata: {
    type: string
    tags: string[]
    description: string
  }
}

// 使用 Pinecone/Milvus 存储
```

---

**上一部分**：[04_技术架构.md](./202601240957_04_技术架构.md)
**下一部分**：[06_MVP与迭代路线.md](./202601240959_06_MVP与迭代路线.md)
